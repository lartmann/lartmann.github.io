<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> RAG für medizinische Leitlinien | Lisa Artmann </title> <meta name="author" content="Lisa Artmann"> <meta name="description" content="Retrieval Augmented Generation um die Leitlinien der Arbeitsgemeinschaft der Wissenschaftlichen Medizinischen Fachgesellschaften e.V. (AWMF) effizient durchsuchen zu können."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://lartmann.github.io/projects/1_project/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Lisa</span> Artmann </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">RAG für medizinische Leitlinien</h1> <p class="post-description">Retrieval Augmented Generation um die Leitlinien der Arbeitsgemeinschaft der Wissenschaftlichen Medizinischen Fachgesellschaften e.V. (AWMF) effizient durchsuchen zu können.</p> </header> <article> <p><a href="https://github.com/lartmann/Leitlinien-RAG" rel="external nofollow noopener" target="_blank">Link to Code Repository</a></p> <h1 id="demo"><a href="http://217.154.8.88:8501" rel="external nofollow noopener" target="_blank">Demo</a></h1> <iframe width="100%" height="500vh" src="http://217.154.8.88:8501" title="Demo: RAG für medizinische Leitlinien"></iframe> <h1 id="setup">Setup</h1> <ol> <li>Erstelle eine <code class="language-plaintext highlighter-rouge">.env</code>-Datei und füge den Token für das LLM von Mistral unter <code class="language-plaintext highlighter-rouge">MISTRAL_API_KEY</code> hinzu.</li> <li>Führe <code class="language-plaintext highlighter-rouge">python3 scraper.py</code> aus, um alle Leitlinien von der offiziellen Website herunterzuladen.</li> <li>Führe <code class="language-plaintext highlighter-rouge">rag.ipynb</code> aus, um die Leitlinien in einer Vektor-Datenbank zu indexieren.</li> <li>Starte die Demo mithilfe des Dockerfiles.</li> </ol> <h1 id="hintergrund">Hintergrund</h1> <p>Die medizinischen Fachgesellschaften erstellen für ihr jeweiliges Fachgebiet Leitlinien. Diese Leitlinien sind sehr wichtig, da Ärzte dort rechtlich haltbare Empfehlungen für die Behandlung ihrer Patienten finden. Auch Patienten können sich hier über die empfohlene Behandlung für ihre Krankheit informieren. Alle aktuellen Leitlinien sind im Leitlinienregister der <a href="https://register.awmf.org" rel="external nofollow noopener" target="_blank">Arbeitsgemeinschaft der Wissenschaftlichen Medizinischen Fachgesellschaften e.V. (AWMF)</a> frei verfügbar. Dort kann nach Fachgesellschaft sortiert und die entsprechende Leitlinie als PDF heruntergeladen werden.</p> <p>Die Suche nach der richtigen Stelle kann allerdings sehr aufwendig sein. Aus über 800 Leitlinien muss erst einmal die passende ausgewählt werden. Wo findet man beispielsweise Informationen zur Anästhesiegabe für eine Zahnextraktion bei Menschen mit Nierentransplantation? In der Leitlinie <a href="https://register.awmf.org/de/leitlinien/detail/166-007" rel="external nofollow noopener" target="_blank">Immunsuppression nach pädiatrischer Nierentransplantation</a>, in der Leitlinie <a href="https://register.awmf.org/de/leitlinien/detail/007-003" rel="external nofollow noopener" target="_blank">Operative Entfernung von Weisheitszähnen</a> oder in der Leitlinie <a href="https://register.awmf.org/de/leitlinien/detail/083-035" rel="external nofollow noopener" target="_blank">Zahnärztliche Behandlungsempfehlungen vor und nach einer Organtransplantation</a>? Im schlimmsten Fall müsste man all diese Leitlinien überprüfen, um die richtige Empfehlung zu finden. Doch damit nicht genug: Die Suche nach der richtigen Information endet nicht bei der richtigen Leitlinie. Oft haben die Leitlinien über 100 Seiten, auf denen im besten Fall irgendwo die gesuchte Information zu finden ist. Insgesamt lässt sich sagen, dass die Suche in den Leitlinien aktuell sehr ineffizient ist.</p> <h1 id="methoden">Methoden</h1> <p>Das Ziel dieses Projekts ist es, diese Suche deutlich zu vereinfachen. Hierzu wird ein Retrieval-Augmented-Generation-System (RAG) erstellt, das alle Leitlinien indexiert und mithilfe einer Similarity Search die richtigen Informationen herausfiltert. Für das RAG-System werden sowohl ein Embedding-Modell als auch ein Large Language Model für den Generierungsprozess benötigt.</p> <h2 id="scraping">Scraping</h2> <p>Die Leitlinien wurden von der offiziellen Seite der <a href="https://register.awmf.org" rel="external nofollow noopener" target="_blank">AWMF</a> gescrapt. Hierzu wurden zunächst alle Fachgesellschaften gespeichert, dann alle Links zu allen Leitlinien jeder einzelnen Fachgesellschaft. Mit diesen Links wurden die PDFs heruntergeladen und die Metadaten in einer JSON-Datei gespeichert. So sollte gewährleistet sein, dass alle Leitlinien erfasst wurden. Da das Leitlinienregister eine Website ist, die sich dynamisch mit JavaScript o. Ä. lädt, habe ich für das Scraping Selenium verwendet.</p> <h2 id="embedding">Embedding</h2> <p>Das Embedding der Vektor-Datenbank wird mit einem Modell von HuggingFace <a class="citation" href="#wang2024multilingual">(Wang et al., 2024)</a> erstellt. Ausschlaggebend für die Wahl dieses Embedding-Modells waren die gute Performance, insbesondere für die deutsche Sprache, und die relativ geringen Ansprüche an die Rechenleistung, die es ermöglichten, die Indexierung auf meinem Rechner auszuführen. Mithilfe des „RecursiveCharacterTextSplitter“ der LangChain-Bibliothek werden die Leitlinien in Abschnitte von ungefähr 1.000 Zeichen aufgeteilt, bevor sie in die Datenbank indexiert werden. Die Indexierung aller Leitlinien in die Chroma-Vektordatenbank dauerte ca. 24 Stunden.</p> <h2 id="large-language-model">Large Language Model</h2> <p>Für den Generationsprozess habe ich die API von Mistral (<a href="https://mistral.ai/news/mistral-small-3-1" rel="external nofollow noopener" target="_blank">Mistral Small 3.1</a>) als Large Language Model verwendet. Ausschlaggebend für die Wahl war hier die gute Performance für die deutsche Sprache und die Tatsache, dass die Nutzung der API mit diesem Modell kostenlos ist.</p> <h2 id="prompt">Prompt</h2> <p>Insbesondere in dieser Anwendung ist es sehr wichtig, dass sich das RAG-System nur auf Quellen bezieht, die tatsächlich so in den Leitlinien stehen. Deshalb habe ich den Prompt so gewählt, dass er den Kontext in Bezug auf die Frage zusammenfasst. Falls die Frage nicht im Hinblick auf den Kontext beantwortet werden kann, soll das ebenfalls gesagt werden. Der genaue Prompt ist im beigefügten Notebook zu finden.</p> <h2 id="metrik">Metrik</h2> <p>Um die Qualität des RAG-Systems zu prüfen, habe ich 13 Stellen aus zufällig ausgewählten Leitlinien für Zahnärzte herausgesucht und zu jeder eine Frage formuliert. So ist gewährleistet, dass die Frage in den Leitlinien beantwortet ist. Einige Fragen habe ich so formuliert, dass sie ein gewisses Maß an Übertragungsleistung erfordern. Ein Beispiel ist die Frage: „Welchen Werkstoff sollte man bei einer vollkeramischen, einflügeligen Adhäsivbrücke an den Inzisiven verwenden?” Hier wird vorausgesetzt, dass erkannt wird, dass Inzisiven Frontzähne sind, da in der Leitlinie nur von Frontzähnen die Rede ist. Diese Übertragungsleistung wurde in der Frage „Welchen Werkstoff sollte man bei einer vollkeramischen, einflügeligen Adhäsivbrücke von 11 nach 22 verwenden?” noch mehr auf die Probe gestellt. In den Leitlinien ist nicht explizit erwähnt, dass 11 und 22 Frontzähne sind. Das heißt, dass das LLM und das Embedding-Model diese Übertragungsleistung durch das eigene Embedding erbringen müssen. Die Performance wird durch die Anzahl der richtig beantworteten Fragen im generierten Text gemessen und dadurch, ob die Antwort im Kontext zu finden ist. Eine weitere Metrik ist die Zeit, die für die RAG-Inferenz benötigt wird.</p> <h2 id="vergleich">Vergleich</h2> <p>Dabei wird die Performance verglichen, wenn die Vektordatenbank alle Leitlinien enthält, und wenn sie nur Leitlinien enthält, die für Zahnärzte vorgesehen sind oder thematisch mit Zahnmedizin oder Mund-, Kiefer- und Gesichtschirurgie zu tun haben. Durch den Vergleich dieser beiden Varianten soll festgestellt werden, ob die allgemeinere Datenbank Nachteile in Bezug auf Richtigkeit oder Schnelligkeit aufweist. Die Datenbank mit den zahnmedizinischen Leitlinien enthält nur etwa 100 indexierte Leitlinien und ist somit deutlich kleiner als die Datenbank mit allen Leitlinien, die mehr als 800 Leitlinien indexiert hat.</p> <hr> <h1 id="ergebnisse">Ergebnisse</h1> <p>Das RAG-System konnte alle Fragen richtig beantworten. Es konnte sogar in beiden Fällen die oben genannte Übertragungsleistung erbringen. Der einzige Unterschied zwischen den verschiedenen Datenbanken war die Inferenzzeit, die bei der Datenbank mit allen Leitlinien im Schnitt 34% länger war. Die Richtigkeit der Antworten und des Kontexts war jedoch gleich.</p> <p>Zwei der insgesamt 26 Antworten waren auf Englisch statt auf Deutsch, was aber wahrscheinlich durch eine Änderung des Prompts vermieden werden könnte. In den Antworten waren keinerlei Halluzinationen festzustellen. Ein weiteres Phänomen ist, dass sich im Inhaltsverzeichnis Einträge ohne relevanten Inhalt finden, beispielsweise ein Ausschnitt aus dem Literaturverzeichnis ohne Bezug zur Fragestellung.</p> <table> <thead> <tr> <th><strong>Modus</strong></th> <th><strong>Richtige Antworten</strong></th> <th><strong>Leitlinienstelle mit richtiger Antwort</strong></th> <th><strong>Durchschnittliche Inferenzzeit</strong></th> </tr> </thead> <tbody> <tr> <td>Nur zahnmedizinische Leitlinien</td> <td>100%</td> <td>100%</td> <td>5.07 s</td> </tr> <tr> <td>Alle verfügbaren Leitlinien</td> <td>100%</td> <td>100%</td> <td>6.81 s</td> </tr> </tbody> </table> <hr> <h1 id="diskussion">Diskussion</h1> <p>Das vorgestellte Projekt zeigt, dass sich die Suche nach bestimmten Inhalten in medizinischen Leitlinien durch ein RAG-System enorm vereinfachen lässt.</p> <p>Allerdings gibt es auch einige Einschränkungen bezüglich der Leistung. Die hier getesteten Fragen waren in den Leitlinien immer eindeutig beantwortet. Es wurde jedoch nicht getestet, wie sich das System verhält, wenn die Antwort nicht in den Leitlinien zu finden ist oder sehr uneindeutig ist. Zudem bleibt offen, wie sich das System bei Fragen verhält, die ein großes Maß an Hintergrundwissen voraussetzen. Zwar wurde dies für den Fall getestet, dass die Inzisiven 11 und 22 alles Frontzähne sind, allerdings bleibt offen, wie es bei deutlich komplexerem Hintergrundwissen funktionieren würde.</p> <p>Das System wurde ausschließlich auf zahnmedizinische Fragestellungen hin getestet. Daher ist unklar, wie gut es in anderen medizinischen Bereichen performt. Zudem wurde nicht untersucht, wie das RAG-System auf ungenaue Fragestellungen reagiert. Da viele Begriffe doppeldeutig sind, kann es passieren, dass das RAG-System zwar richtige, aber nicht die vom Nutzer gesuchten Antworten gibt. So bedeutet das Wort „retiniert” in der Zahnmedizin, dass ein Zahn die Okklusionsebene nicht erreicht, während es in der Augenheilkunde eine Einblutung in die Retina beschreibt. Eine mögliche Lösung für dieses Problem wäre, Filter einzubauen. So könnte man beispielsweise nach dem gesuchten Fachgebiet filtern. Alle nötigen Informationen hierfür sind bereits in den Metadaten der Vektor-Datenbank vorhanden.</p> <p>Verbesserungsmöglichkeiten gitb es auch bei der Indexierung. Die Performance könnte wahrscheinlich verbessert werden, wenn die PDFs auf relevante Inhalte gefiltert werden und beispielsweise Titelseiten, Inhaltsverzeichnisse und Referenzen nicht indexiert werden. Dadurch könnte man verhindern, dass im Kontext Einträge ohne echten Inhalt auftauchen.</p> <p>Zudem könnten die vielen Tabellen in den Leitlinien zu Problemen führen. Bei der Extraktion könnte die semantische Bedeutung verloren gehen.</p> <hr> <h1 id="appendix---fragen">Appendix - Fragen</h1> <ul> <li>Wann ist ein Weisheitszahn vollständig retiniert?</li> <li>Wie lange sollte nach einer Strahlentherapie gewartet werden, bis eine Implantation durchgeführt wird?</li> <li>Wann ist eine Sedierung mit Lachgas empfohlen?</li> <li>Welchen Werkstoff sollte man bei einer vollkeramischen, einflügeligen Adhäsivbrücken im Frontzahnbereich verwenden?</li> <li>Welchen Werkstoff sollte man bei einer vollkeramischen, einflügeligen Adhäsivbrücken an den Inzisiven verwenden?</li> <li>Welchen Werkstoff sollte man bei einer vollkeramischen, einflügeligen Adhäsivbrücken von 11 nach 22 verwenden?</li> <li>Welches Schmerzmittel kann vor einer Nierentransplantation verschrieben werden?</li> <li>Wann ist die Operation multisuturaler und syndromaler Kraniosynostosen hinsichtlich des Gesichtsschädels empfohlen?</li> <li>Was muss bei einer Verbundbrücke mit endodontisch behandelten Zähnen beachtet werden?</li> <li>Was ist Bruxismus?</li> <li>Sollte man zur Verbesserung der Ästhetik eine periimplantäre Weichgewebsaugmentation durchführen?</li> <li>Sollte bei Implantaten ein Test auf Unverträglichkeit für Titian bei Patienten mit Verdacht auf eine Unverträglichkeit durchgeführt werden?</li> <li>Was ist das empfohlene Material für Vollkeramische implantatgetragene Einzelkronen?</li> </ul> <hr> </article> <h2>References</h2> <div class="publications"> <h2 class="bibliography">2024</h2> <ol class="bibliography"><li> <div class="row"> <div class="col col-sm-2 abbr"> </div> <div id="wang2024multilingual" class="col-sm-8"> <div class="title">Multilingual E5 Text Embeddings: A Technical Report</div> <div class="author"> Liang Wang, Nan Yang, Xiaolong Huang, and <span class="more-authors" title="click to view 3 more authors" onclick=" var element=$(this); element.attr('title', ''); var more_authors_text=element.text() == '3 more authors' ? 'Linjun Yang, Rangan Majumder, Furu Wei' : '3 more authors'; var cursorPosition=0; var textAdder=setInterval(function(){ element.html(more_authors_text.substring(0, cursorPosition + 1)); if (++cursorPosition == more_authors_text.length){ clearInterval(textAdder); } }, '10'); ">3 more authors</span> </div> <div class="periodical"> <em>arXiv preprint arXiv:2402.05672</em>, 2024 </div> <div class="periodical"> </div> <div class="links"> </div> </div> </div> </li></ol> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Lisa Artmann. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>